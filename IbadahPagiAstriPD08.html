<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Presence Tracker</title>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <style>
    :root {
      --bg: #f6f7fb;
      --card: #ffffff;
      --text: #222;
      --muted: #666;
      --accent: #2563eb;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }
    .container {
      max-width: 740px;
      margin: 32px auto;
      padding: 24px;
      background: var(--card);
      border-radius: 16px;
      box-shadow: 0 6px 24px rgba(0,0,0,0.08);
    }
    h1 {
      margin: 0 0 4px;
      text-align: center;
      font-size: 28px;
    }
    .date-line {
      margin: 0 0 20px;
      text-align: center;
      color: var(--muted);
      font-size: 14px;
    }
    h2.section-title {
      margin-top: 24px;
      margin-bottom: 12px;
      font-size: 18px;
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 4px;
    }
    ul { list-style: none; padding: 0; margin: 0; }
    li.item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 14px;
      border: 1px solid #eef0f5;
      border-radius: 12px;
      margin-bottom: 10px;
      background: #fff;
    }
    .name { font-weight: 600; }
    .status.present { color: #067e2e; font-weight: 600; }
    .status.absent { color: #dc2626; font-weight: 600; }
    button {
      margin-left: 6px;
      padding: 6px 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .present-btn { background: #22c55e; color: white; }
    .absent-btn { background: #ef4444; color: white; }

    .gateway {
      margin-top: 28px;
      border-top: 1px dashed #e5e7eb;
      padding-top: 16px;
    }
    .gateway h2 { font-size: 18px; margin: 0 0 8px; }
    .gateway a { color: var(--accent); font-weight: 600; text-decoration: none; }
    iframe { width: 100%; height: 380px; border: 0; border-radius: 12px; }

    .count {
      margin: 12px 0 18px;
      color: var(--muted);
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Presence Tracker</h1>
    <p class="date-line">Today: <span id="today-date">—</span></p>

    <div class="count">Total present: <span id="count">0</span></div>

    <h2 class="section-title">Not Marked</h2>
    <ul id="neutral-list"></ul>

    <h2 class="section-title">Present</h2>
    <ul id="present-list"></ul>

    <h2 class="section-title">Absent</h2>
    <ul id="absent-list"></ul>

    <div class="gateway">
      <h2>Daily Devotional</h2>
      <p><a href="https://alkitab.mobi/renungan/rh/" target="_blank" rel="noopener">🔗 Open Renungan Harian</a></p>
      <iframe src="https://alkitab.mobi/renungan/rh/" title="Renungan Harian"></iframe>
    </div>
  </div>

  <script>
    // ─────────────────────────────────────────────────────────────
    // Firebase config (yours unchanged)
    // ─────────────────────────────────────────────────────────────
    const firebaseConfig = {
      apiKey: "AIzaSyArFFh0kjHidNK8s9M3WZKclirglvq6h6g",
      authDomain: "presence-tracker-astri-3.firebaseapp.com",
      projectId: "presence-tracker-astri-3",
      storageBucket: "presence-tracker-astri-3.firebasestorage.app",
      messagingSenderId: "397297436285",
      appId: "1:397297436285:web:6571143869429d5f66d314",
      measurementId: "G-E9K253LSXM"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Helpers
    function getLocalDateKey() {
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, '0');
      const day = String(d.getDate()).padStart(2, '0');
      return `${y}-${m}-${day}`;
    }
    const todayKey = getLocalDateKey();
    document.getElementById("today-date").textContent = new Date().toLocaleDateString(undefined, {
      weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
    });

    const neutralEl = document.getElementById('neutral-list');
    const presentEl = document.getElementById('present-list');
    const absentEl = document.getElementById('absent-list');
    const countEl = document.getElementById('count');

    // Roster
    const roster = [
      "Agnes Paramitha Nugroho",
      "Benita Joanna Natama Limbong",
      "Callysta Jeconia Purba",
      "Carissa Nathania Purba",
      "Elekta Fortuna Simanullang",
      "Ignatia Anabell",
      "Jessica Clorinda Sihaloho",
      "Jessica Zivanna Novelina Sihombing",
      "Jolie Theresia Marchena Silitonga",
      "Litany Dahliani",
      "Marissa Patricia Simbolon",
      "Michel Claudia Hikaru",
      "Michella Lecika Dumatubun",
      "Sorta Maharani Tambunan",
      "Tisya Angelina Aritonang",
      "Valeria Chelsea De Santa Nugroho",
      "Vanessa Narwastu Arisandhi Tarigan",
      "Yohana Olivia Manurung",
      "Zefanya Reyna Utomo"
    ];

    // Save to Firestore
    async function markStatus(id, name, status, reason="") {
      const ref = db.collection("presence").doc(todayKey).collection("names").doc(id);
      await ref.set({
        name,
        status,
        reason,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
    }

    // Create row element
    function makeRow(name, record, id) {
      const li = document.createElement("li");
      li.className = "item";
      const statusText = record.status === "present"
        ? "✅ Present"
        : record.status === "absent"
          ? "❌ Absent (" + (record.reason || "") + ")"
          : "— Not Marked";

      li.innerHTML = `
        <span class="name">${name}</span>
        <span class="status ${record.status || ""}">${statusText}</span>
      `;

      // Buttons only if not marked
      if (!record.status) {
        const presentBtn = document.createElement("button");
        presentBtn.textContent = "Present";
        presentBtn.className = "present-btn";
        presentBtn.onclick = () => markStatus(id, name, "present");

        const absentBtn = document.createElement("button");
        absentBtn.textContent = "Absent";
        absentBtn.className = "absent-btn";
        absentBtn.onclick = () => {
          const reason = prompt("Enter reason for absence:");
          if (reason) markStatus(id, name, "absent", reason);
        };

        li.appendChild(presentBtn);
        li.appendChild(absentBtn);
      }

      return li;
    }

    // Render all sections
    function renderLists(data) {
      neutralEl.innerHTML = "";
      presentEl.innerHTML = "";
      absentEl.innerHTML = "";

      let presentCount = 0;

      roster.forEach(name => {
        const id = name.toLowerCase().replace(/\s+/g, "_");
        const record = data[id] || {};
        const row = makeRow(name, record, id);

        if (!record.status) {
          neutralEl.appendChild(row);
        } else if (record.status === "present") {
          presentEl.appendChild(row);
          presentCount++;
        } else if (record.status === "absent") {
          absentEl.appendChild(row);
        }
      });

      countEl.textContent = presentCount;
    }

    // Real-time Firestore listener
    db.collection("presence").doc(todayKey).collection("names").onSnapshot(snap => {
      const data = {};
      snap.forEach(doc => data[doc.id] = doc.data());
      renderLists(data);
    });
  </script>
</body>
</html>

