<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Presence Tracker</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <style>
    :root {
      --bg: #f6f7fb;
      --card: #ffffff;
      --text: #222;
      --muted: #666;
      --accent: #2563eb;
      --present: #067e2e;
      --absent: #d00000;
    }
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
    }
    .container {
  max-width: 620px; /* was 540px */
  margin: 32px auto;
  padding: 24px;
  background: var(--card);
  border-radius: 16px;
  box-shadow: 0 6px 24px rgba(0,0,0,0.08);
    }
    h1 { margin: 0; text-align: center; }
    .date-line {
      text-align: center;
      margin: 12px 0 24px;
      font-size: 16px;
    }
    .date-line button {
      border: none;
      background: none;
      font-size: 18px;
      cursor: pointer;
      font-weight: bold;
      color: var(--accent);
    }
    .student {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 14px;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      margin-bottom: 8px;
      background: #fff;
      min-height: 52px;
    }
    .student .name { font-weight: 600; }
    .student select, .student input {
      margin-left: 8px;
      padding: 4px 6px;
      border-radius: 6px;
    }
    .student button {
      margin-left: 6px;
      padding: 4px 6px;
      border: none;
      border-radius: 6px;
      background: var(--accent);
      color: #fff;
      cursor: pointer;
    }
    .student button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .section { margin-top: 24px; }
    .section h2 {
      font-size: 18px;
      margin-bottom: 12px;
      padding-left: 4px;
    }
    .status-present { color: var(--present); font-weight: 600; }
    .status-absent { color: var(--absent); font-weight: 600; }
    .gateway {
      margin-top: 28px;
      border-top: 1px dashed #e5e7eb;
      padding-top: 16px;
      text-align: center;
    }
    iframe {
      width: 100%;
      height: 380px;
      border: 0;
      border-radius: 12px;
      margin-top: 10px;
    }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Presence Tracker</h1>
    <div class="date-line">
      <button id="prevDay">&lt;</button>
      <span id="today-date">‚Äî</span>
      <button id="nextDay">&gt;</button>
    </div>

    <div class="section">
      <h2>Not Marked</h2>
      <ul id="neutral-list"></ul>
    </div>
    <div class="section">
      <h2>Present</h2>
      <ul id="present-list"></ul>
    </div>
    <div class="section">
      <h2>Absent (with reason)</h2>
      <ul id="absent-list"></ul>
    </div>

    <div class="gateway">
      <h2>Daily Devotional</h2>
      <p>
        üìñ <a href="https://alkitab.mobi/renungan/rh/" target="_blank">Click here to open Renungan Harian</a>
      </p>
      <iframe src="https://alkitab.mobi/renungan/rh/" title="Renungan Harian"></iframe>
    </div>
  </div>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyArFFh0kjHidNK8s9M3WZKclirglvq6h6g",
      authDomain: "presence-tracker-astri-3.firebaseapp.com",
      projectId: "presence-tracker-astri-3",
      storageBucket: "presence-tracker-astri-3.firebasestorage.app",
      messagingSenderId: "397297436285",
      appId: "1:397297436285:web:6571143869429d5f66d314",
      measurementId: "G-E9K253LSXM"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const allStudents = [
      "Agnes Paramitha Nugroho","Benita Joanna Natama Limbong","Callysta Jeconia Purba",
      "Carissa Nathania Purba","Elekta Fortuna Simanullang","Ignatia Anabell","Jessica Clorinda Sihaloho",
      "Jessica Zivanna Novelina Sihombing","Jolie Theresia Marchena Silitonga","Litany Dahliani",
      "Marissa Patricia Simbolon","Michel Claudia Hikaru","Michella Lecika Dumatubun",
      "Sorta Maharani Tambunan","Tisya Angelina Aritonang","Valeria Chelsea De Santa Nugroho",
      "Vanessa Narwastu Arisandhi Tarigan","Yohana Olivia Manurung","Zefanya Reyna Utomo"
    ];

    const dateEl = document.getElementById("today-date");
    const prevBtn = document.getElementById("prevDay");
    const nextBtn = document.getElementById("nextDay");
    const neutralList = document.getElementById("neutral-list");
    const presentList = document.getElementById("present-list");
    const absentList = document.getElementById("absent-list");

    let currentDate = new Date();
    const todayKey = formatKey(new Date());

    function formatKey(d) {
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,"0");
      const day = String(d.getDate()).padStart(2,"0");
      return `${y}-${m}-${day}`;
    }
    function formatReadable(d) {
      return d.toLocaleDateString(undefined, { weekday:"long", year:"numeric", month:"long", day:"numeric"});
    }

    function renderDate() {
      dateEl.textContent = formatReadable(currentDate);
      loadDay();
    }

    prevBtn.onclick = () => { currentDate.setDate(currentDate.getDate()-1); renderDate(); };
    nextBtn.onclick = () => { currentDate.setDate(currentDate.getDate()+1); renderDate(); };

    async function loadDay() {
      const key = formatKey(currentDate);
      const snap = await db.collection("presence").doc(key).collection("names").get();
      const data = {};
      snap.forEach(doc => data[doc.id] = doc.data());

      neutralList.innerHTML = "";
      presentList.innerHTML = "";
      absentList.innerHTML = "";

      const isToday = key === todayKey;
      const isFuture = currentDate > new Date();

      allStudents.forEach(name => {
        const id = name.toLowerCase();
        const record = data[id];

        if (!record) {
          // not marked
          const li = document.createElement("li");
          li.className = "student";
          if (isToday && !isFuture) {
            li.innerHTML = `<span class="name">${name}</span>
              <div>
                <select>
                  <option value="">‚Äî</option>
                  <option value="present">Present</option>
                  <option value="absent">Absent</option>
                </select>
                <span class="absent-extra" style="display:none">
                  <input type="text" placeholder="Reason" />
                  <button>‚úÖ</button>
                </span>
              </div>`;
            const select = li.querySelector("select");
            const extra = li.querySelector(".absent-extra");
            const input = li.querySelector("input");
            const btn = li.querySelector("button");

            select.onchange = () => {
              if (select.value === "absent") {
                extra.style.display="inline-block";
              } else {
                extra.style.display="none";
                if (select.value === "present") markStatus(id,name,"present","");
              }
            };
            btn.onclick = () => {
              if (input.value.trim() !== "") {
                markStatus(id,name,"absent",input.value.trim());
              } else {
                alert("Please provide a reason.");
              }
            };
          } else {
            li.innerHTML = `<span class="name">${name}</span>
              <span style="color:var(--muted)">‚Äî</span>`;
          }
          neutralList.appendChild(li);
        } else if (record.status === "present") {
          // present
          const li = document.createElement("li");
          li.className = "student";
          li.innerHTML = `<span class="name">${name}</span><span class="status-present">‚úÖ Present</span>`;
          presentList.appendChild(li);
        } else if (record.status === "absent") {
          // absent
          const li = document.createElement("li");
          li.className = "student";
          li.innerHTML = `<span class="name">${name}</span>
            <span class="status-absent">‚ùå Absent (${record.reason||""})</span>`;
          absentList.appendChild(li);
        }
      });
    }

    async function markStatus(id,name,status,reason="") {
      const key = formatKey(currentDate);
      const ref = db.collection("presence").doc(key).collection("names").doc(id);
      await ref.set({ name, status, reason }, { merge:true });
      loadDay();
    }

    renderDate();
  </script>
</body>
</html>






